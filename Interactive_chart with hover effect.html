<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Interactive Profit Graph</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .slider-container { margin-bottom: 10px; }
        label { display: inline-block; width: 150px; }
        input { width: 200px; }
        .info-box {
            background-color: #f4f4f4;
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            width: fit-content;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>

<h2>Interactive Profit Model</h2>

<div class="slider-container">
    <label>Price ($):</label>
    <input type="range" id="price" min="1" max="100" step="1" value="50">
    <span id="price-val">50</span>
</div>

<div class="slider-container">
    <label>Variable Cost ($):</label>
    <input type="range" id="varCost" min="0" max="80" step="1" value="30">
    <span id="varCost-val">30</span>
</div>

<div class="slider-container">
    <label>Fixed Cost ($):</label>
    <input type="range" id="fixedCost" min="0" max="5000" step="100" value="3000">
    <span id="fixedCost-val">3000</span>
</div>

<div class="info-box">
    <strong>Unit Contribution Margin:</strong> $<span id="unitCM"></span><br>
    <strong>Break-even Sales Volume:</strong> <span id="breakEven"></span> units
</div>

<div id="chart"></div>

<script>
function calculateData(price, varCost, fixedCost) {
    let volumes = [];
    let profits = [];
    let revenues = [];
    let costs = [];
    let hoverData = [];

    for (let q = 0; q <= 500; q += 10) {
        let revenue = price * q;
        let totalCost = fixedCost + varCost * q;
        let profit = revenue - totalCost;

        volumes.push(q);
        profits.push(profit);
        revenues.push(revenue);
        costs.push(totalCost);

        hoverData.push({
            revenue: revenue,
            cost: totalCost,
            profit: profit,
            status: profit >= 0 ? "Positive Profit" : "Negative Profit"
        });
    }
    return { volumes, profits, revenues, costs, hoverData };
}

function updateChart() {
    let price = parseFloat(document.getElementById('price').value);
    let varCost = parseFloat(document.getElementById('varCost').value);
    let fixedCost = parseFloat(document.getElementById('fixedCost').value);

    document.getElementById('price-val').innerText = price;
    document.getElementById('varCost-val').innerText = varCost;
    document.getElementById('fixedCost-val').innerText = fixedCost;

    let unitCM = price - varCost;
    let breakEven = unitCM > 0 ? (fixedCost / unitCM).toFixed(1) : "N/A";

    document.getElementById('unitCM').innerText = unitCM.toFixed(2);
    document.getElementById('breakEven').innerText = breakEven;

    let { volumes, profits, revenues, costs, hoverData } = calculateData(price, varCost, fixedCost);

    // Profit curve
    let trace1 = {
        x: volumes,
        y: profits,
        type: 'scatter',
        mode: 'lines',
        name: 'Profit',
        line: { color: 'black', width: 2 },
        hovertemplate:
            'Sales Volume: %{x} units<br>' +
            'Revenue: $%{customdata[0]:,.2f}<br>' +
            'Total Cost: $%{customdata[1]:,.2f}<br>' +
            'Profit: $%{customdata[2]:,.2f}<br>' +
            '%{customdata[3]}<extra></extra>',
        customdata: hoverData.map(d => [d.revenue, d.cost, d.profit, d.status]),
        yaxis: 'y'
    };

    // Total Revenue line
    let trace2 = {
        x: volumes,
        y: revenues,
        type: 'scatter',
        mode: 'lines',
        name: 'Total Revenue',
        line: { color: 'blue', width: 2, dash: 'solid' },
        hoverinfo: 'skip',
        yaxis: 'y2'
    };

    // Total Cost line
    let trace3 = {
        x: volumes,
        y: costs,
        type: 'scatter',
        mode: 'lines',
        name: 'Total Cost',
        line: { color: 'orange', width: 2, dash: 'solid' },
        hoverinfo: 'skip',
        yaxis: 'y2'
    };

    // Break-even marker
    let trace4 = {};
    if (breakEven !== "N/A" && breakEven >= 0 && breakEven <= 500) {
        trace4 = {
            x: [parseFloat(breakEven)],
            y: [0],
            type: 'scatter',
            mode: 'markers+text',
            name: 'Break-even Point',
            text: [`Break-even: ${breakEven} units`],
            textposition: 'top center',
            marker: { size: 10, color: 'green' },
            hoverinfo: 'skip',
            yaxis: 'y'
        };
    }

    // Shading for profit region (green)
    let profitRegion = {
        type: 'rect',
        xref: 'x',
        yref: 'paper',
        x0: breakEven !== "N/A" ? parseFloat(breakEven) : 0,
        y0: 0,
        x1: 500,
        y1: 1,
        fillcolor: 'rgba(0, 255, 0, 0.1)',
        line: { width: 0 }
    };

    // Shading for loss region (red)
    let lossRegion = {
        type: 'rect',
        xref: 'x',
        yref: 'paper',
        x0: 0,
        y0: 0,
        x1: breakEven !== "N/A" ? parseFloat(breakEven) : 500,
        y1: 1,
        fillcolor: 'rgba(255, 0, 0, 0.1)',
        line: { width: 0 }
    };

    // Dashed vertical line at break-even
    let breakEvenLine = {
        type: 'line',
        x0: breakEven !== "N/A" ? parseFloat(breakEven) : null,
        x1: breakEven !== "N/A" ? parseFloat(breakEven) : null,
        y0: Math.min(...profits),
        y1: Math.max(...profits),
        line: { dash: 'dot', color: 'green' }
    };

    let layout = {
        title: 'Profit, Revenue, and Cost vs Sales Volume',
        xaxis: { title: 'Sales Volume' },
        yaxis: { title: 'Profit ($)', side: 'left' },
        yaxis2: {
            title: 'Revenue / Cost ($)',
            overlaying: 'y',
            side: 'right'
        },
        shapes: breakEven !== "N/A" && breakEven >= 0 && breakEven <= 500
            ? [profitRegion, lossRegion, breakEvenLine]
            : [],
        hovermode: 'closest'
    };

    let data = [trace1, trace2, trace3];
    if (breakEven !== "N/A" && breakEven >= 0 && breakEven <= 500) {
        data.push(trace4);
    }

    Plotly.newPlot('chart', data, layout);
}

document.querySelectorAll('#price, #varCost, #fixedCost').forEach(el => {
    el.addEventListener('input', updateChart);
});

updateChart();
</script>

</body>
</html>
